{% extends "base.html" %}

{% block title %}Statistics - Racing Simple{% endblock %}

{% block content %}
<h2>Statistics</h2>

<div id="loading">Loading statistics...</div>
<div id="error" class="error" style="display: none;"></div>

<div id="stats-container" style="display: none;">
    <div class="stats-summary">
        <h3>Summary</h3>
        <p>Total Races: <span id="total-races">0</span></p>
        <p>Total Horses: <span id="total-horses">0</span></p>
    </div>
    
    <div class="stats-section">
        <h3>Top Jockeys</h3>
        <table class="stats-table" id="jockeys-table">
            <thead>
                <tr>
                    <th>Jockey</th>
                    <th>Mounts</th>
                    <th>Tracks</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <div class="stats-section">
        <h3>Top Trainers</h3>
        <table class="stats-table" id="trainers-table">
            <thead>
                <tr>
                    <th>Trainer</th>
                    <th>Entries</th>
                    <th>Tracks</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadStats();
});

async function loadStats() {
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const container = document.getElementById('stats-container');
    
    try {
        const response = await fetch('/api/stats');
        const data = await response.json();
        
        if (!data.success) {
            throw new Error(data.error || 'Failed to load statistics');
        }
        
        // Update summary
        document.getElementById('total-races').textContent = data.total_races;
        document.getElementById('total-horses').textContent = data.total_horses;
        
        // Update jockeys table
        const jockeysBody = document.querySelector('#jockeys-table tbody');
        jockeysBody.innerHTML = '';
        
        if (data.jockeys.length === 0) {
            jockeysBody.innerHTML = '<tr><td colspan="3">No data available</td></tr>';
        } else {
            data.jockeys.forEach(jockey => {
                const row = jockeysBody.insertRow();
                row.innerHTML = `
                    <td class="name">${jockey.name}</td>
                    <td>${jockey.mounts}</td>
                    <td class="tracks">${jockey.tracks.join(', ')}</td>
                `;
            });
        }
        
        // Update trainers table
        const trainersBody = document.querySelector('#trainers-table tbody');
        trainersBody.innerHTML = '';
        
        if (data.trainers.length === 0) {
            trainersBody.innerHTML = '<tr><td colspan="3">No data available</td></tr>';
        } else {
            data.trainers.forEach(trainer => {
                const row = trainersBody.insertRow();
                row.innerHTML = `
                    <td class="name">${trainer.name}</td>
                    <td>${trainer.entries}</td>
                    <td class="tracks">${trainer.tracks.join(', ')}</td>
                `;
            });
        }
        
        loading.style.display = 'none';
        container.style.display = 'block';
        
    } catch (err) {
        loading.style.display = 'none';
        error.textContent = 'Error loading statistics: ' + err.message;
        error.style.display = 'block';
    }
}
</script>

<style>
.stats-summary {
    background: #f0f0f0;
    padding: 1rem;
    margin-bottom: 2rem;
    border-radius: 4px;
}

.stats-summary h3 {
    margin-top: 0;
}

.stats-summary p {
    margin: 0.5rem 0;
    font-size: 1.1em;
}

.stats-section {
    margin-bottom: 2rem;
}

.stats-table {
    width: 100%;
    margin-top: 1rem;
}

.stats-table td {
    padding: 0.5rem;
}

.stats-table .tracks {
    font-size: 0.9em;
    color: #666;
}
</style>
{% endblock %}